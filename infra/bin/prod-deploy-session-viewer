#!/bin/bash
set -e -u

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(dirname "$(dirname "$SCRIPT_DIR")")"
SESSION_VIEWER_DIR="$REPO_ROOT/session-viewer"

BUCKET="custardseed-session-viewer"

# Build
echo "Building session-viewer..."
cd "$SESSION_VIEWER_DIR"
npm ci
npm run build:prod

# Deploy
echo "Deploying to gs://$BUCKET..."
gcloud storage rsync -r --delete-unmatched-destination-objects dist gs://$BUCKET

echo "Deployed to https://custardseed.com"
